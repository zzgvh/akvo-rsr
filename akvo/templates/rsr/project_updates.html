{% extends "rsr/project_base.html" %}

{% comment %}
Akvo RSR is covered by the GNU Affero General Public License, see more details in the license.txt file located at the root folder of the Akvo RSR module. 
For additional details on the GNU license please see < http://www.gnu.org/licenses/agpl.html >.
{% endcomment %}

{% load i18n rsr_tags %}

{% block title %}{{block.super}} - {% trans 'All project updates' %}{% endblock title %}

{% block script %}
{#<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script> #}
<script type="text/javascript" src="{{MEDIA_URL}}js/jquery-1.3.2.min.js"></script>


<script src="{{MEDIA_URL}}js/ui.tabs.pack.js" type="text/javascript"></script>

<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key={{google_maps_api_key}}"
        type="text/javascript"></script>
   
<script type="text/javascript">

	$(function(){
    	$('#container-1 > ul').tabs();
	});
	
	$(document).ready(function(){
    	$(".btn-slide").click(function(){
    		$("#panel").slideToggle("slow");
    		$(this).toggleClass("active"); return false;
    	});
	});
    
    var oMarker;

    function makeMap(mapId, lat, long) {    
        var gMapDiv = document.getElementById(mapId);
        var googMap = new GMap2(gMapDiv);
        googMap.addControl(new GLargeMapControl3D());
        googMap.addControl(new GMapTypeControl());
        googMap.setCenter(new GLatLng(lat, long), 13);
    
        //if (oMarker)
        //oMap.removeOverlay(oMarker)
    
        // add a new marker
        oMarker = new GMarker(new GLatLng(lat, long));
        googMap.addOverlay(oMarker);
        return googMap;
    };

</script>
{% endblock script %}

{% block breadcrumbs %}
{{block.super}} &raquo; <a href="{% url akvo.rsr.views.projectlist %}">{% trans 'Project listing' %}</a> &raquo; <a href="{% url akvo.rsr.views.projectmain p.id %}">{{p.name}}</a> &raquo; {% trans 'All project updates' %}
{% endblock breadcrumbs %}

{% block page_id %}
<div id="page_project_updates">
{% endblock page_id %}

{% block outer_leftwing %}
<div id="outer_leftwing">

	<div class="boxhead">
		{% if can_add_update %}
		<a class="actionbutton ab_grey" href="{% url akvo.rsr.views.updateform p.id %}" onclick="this.blur();"><span>{% trans 'Add update' %}</span></a>
		{% endif %}
		<h1 class="section">{{p.name}}</h1>
		<p>{{p.subtitle}}</p>

	</div> <!-- .boxhead -->
	
	<div id="project_updates" class="boxbody" style="padding-top: 10px;">

		<a href="/rsr/rss/updates/{{p.id}}/" class="rss" style="float:right; margin-top: 12px">{% trans 'Subscribe via RSS' %}</a>
		<h1 class="section">{% trans 'Project updates' %}</h1>
        <p class="lightx1">{% trans 'The updates are owned by whoever posted them. We are not responsible for them in any way.' %}</p>
        {% for u in updates %}
            <hr />
            <a name={{u.id}} />
            <h2>{{u.title}}</h2>
            <p>
                <span class="lightx1">
                    {{u.time|date:"Y-m-d H:i" }}
                </span>
                {% blocktrans with u.user.get_full_name as user_name and u.user.userprofile.organisation.name as user_org and u.user.userprofile.organisation.get_absolute_url as org_url and u.get_update_method_display as update_meth %}by {{user_name}}, <a href="{{org_url}}">{{user_org}}</a>, via {{update_meth}}{% endblocktrans %}
            </p>
            <!--<p><span class="lightx1">Status:</span> {{u.show_status}}</p>-->
            <br />
            {% ifequal u.photo_location 'B' %}
                {% update_thumb u 668 501 'True' %}
            {% endifequal %}
            {% if u.text %}
                <p>{{u.text}}</p>
            {% endif %}
            {% ifequal u.photo_location 'E' %}
                {% update_thumb u 668 501 'True' %}
            {% endifequal %}
            <p style="text-align:right; clear: both;"><a href="{% url akvo.rsr.views.projectupdates p.id %}#{{u.id}}">{% trans 'Permalink' %}</a></p>
        {% endfor %}

	</div> <!-- #project_updates & .boxbody -->

</div> <!-- #outer_leftwing -->
{% endblock outer_leftwing %}
